#!/bin/bash

# –Ü–º'—è –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É
SRC_FILE="matrix_mul.cu"
OUTPUT_FILE="matrix_mul"

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ CUDA-–∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞ nvcc
if ! command -v nvcc &> /dev/null
then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: CUDA-–∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä (nvcc) –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ CUDA –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ."
    exit 1
fi

# –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è CUDA-–ø—Ä–æ–≥—Ä–∞–º–∏
echo "üöÄ –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è $SRC_FILE..."
nvcc -O3 -arch=sm_50 -o $OUTPUT_FILE $SRC_FILE

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –±—É–ª–∞ —É—Å–ø—ñ—à–Ω–æ—é
if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó!"
    exit 1
fi

echo "‚úÖ –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!"

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏
echo "üéØ –ó–∞–ø—É—Å–∫ CUDA-–º–Ω–æ–∂–µ–Ω–Ω—è –º–∞—Ç—Ä–∏—Ü—å..."
./$OUTPUT_FILE
